<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Custom Cast Receiver</title>
    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <style>
      body {
        margin: 0;
        background-color: #000;
        overflow: hidden;
      }

      cast-media-player {
        --splash-image: url("https://example.com/initial-image.jpg"); /* Default image */
      }
    </style>
</head>
<body>
  <cast-media-player></cast-media-player> <!-- Keeps the default media player UI -->

  <script>
    const context = cast.framework.CastReceiverContext.getInstance();
    const playerManager = context.getPlayerManager();
    let previousMetadata = { title: '', artist: '', imageUrl: '' }; // Store previous metadata

    // Start the Cast receiver context
    context.start();

    // Log when the receiver is ready
    context.addEventListener(cast.framework.system.EventType.READY, () => {
      console.log("Receiver is ready!");
    });

    // Function to fetch metadata from the API (dummy function, replace with real API call)
    function fetchMetadata() {
      return {
        title: "Sample Title", // Replace with real data
        artist: "Sample Artist", // Replace with real data
        imageUrl: "https://example.com/sample-image.jpg" // Replace with real data
      };
    }

    // Function to update the media player UI if metadata has changed
    function updateMetadata() {
      const newMetadata = fetchMetadata();

      // Check if the new data is different from the previous data
      if (newMetadata.title !== previousMetadata.title ||
          newMetadata.artist !== previousMetadata.artist ||
          newMetadata.imageUrl !== previousMetadata.imageUrl) {

        // Update the media player
        let playerElement = document.getElementsByTagName("cast-media-player")[0];

        // Update title and artist
        playerElement.setAttribute('title', newMetadata.title);
        playerElement.setAttribute('artist', newMetadata.artist);

        // Update image
        playerElement.style.setProperty('--splash-image', `url("${newMetadata.imageUrl}")`);

        console.log(`Updated metadata to: ${newMetadata.title} by ${newMetadata.artist}`);

        // Update the previous metadata
        previousMetadata = newMetadata;
      } else {
        console.log("Metadata has not changed, no update needed.");
      }
    }

    // First fetch after 10 seconds
    setTimeout(() => {
      updateMetadata();

      // Then fetch every 10 seconds
      setInterval(() => {
        updateMetadata();
      }, 10000);
    }, 10000);
  </script>
</body>
</html>
