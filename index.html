<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Custom Receiver</title>
    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script type="text/javascript">
      window.onload = function() {
        const context = cast.framework.CastReceiverContext.getInstance();
        const playerManager = context.getPlayerManager();

        // Listen for custom messages from the sender app
        context.addCustomMessageListener('urn:x-cast:com.example.custom', (event) => {
          const data = JSON.parse(event.data);
          
          // Create new metadata object with updated values
          const metadata = new cast.framework.messages.MediaMetadata(cast.framework.messages.MetadataType.MUSIC_TRACK);
          metadata.title = data.title;
          metadata.artist = data.artist;
          metadata.images = [{ url: data.imageUrl }];

          // Create new media information object with updated metadata
          const mediaInformation = new cast.framework.messages.MediaInformation();
          mediaInformation.contentId = playerManager.getMediaInformation().contentId;  // Keep the same contentId
          mediaInformation.streamType = playerManager.getMediaInformation().streamType;  // Keep the same stream type
          mediaInformation.contentType = playerManager.getMediaInformation().contentType;  // Keep the same content type
          mediaInformation.metadata = metadata;  // Assign updated metadata

          // Apply the updated media information with new metadata
          playerManager.setMediaInformation(mediaInformation);
        });

        context.start();
      };
    </script>
  </head>
  <body>
    <h1>Custom Receiver is running!</h1>
  </body>
</html>
