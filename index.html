<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Custom Receiver</title>
    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script type="text/javascript">
      window.onload = function() {
        const context = cast.framework.CastReceiverContext.getInstance();
        const playerManager = context.getPlayerManager();

        // Start the receiver context and ensure video playback is handled by CAF
        const options = new cast.framework.CastReceiverOptions();
        options.disableIdleTimeout = true; // Optional: prevent Chromecast from timing out
        context.start(options);

        // Listen for custom messages to update metadata
        context.addCustomMessageListener('urn:x-cast:com.example.custom', (event) => {
          const data = JSON.parse(event.data);
          
          // Update metadata
          const metadata = new cast.framework.messages.MediaMetadata(cast.framework.messages.MetadataType.MUSIC_TRACK);
          metadata.title = data.title;
          metadata.artist = data.artist;
          metadata.images = [{ url: data.imageUrl }];

          const mediaInformation = playerManager.getMediaInformation();
          if (mediaInformation) {
            mediaInformation.metadata = metadata;
            playerManager.setMediaInformation(mediaInformation);
            console.log("Metadata updated successfully.");
          }
        });

        console.log("Receiver started with default player");
      };
    </script>
    <style>
      /* Ensure the video takes the full screen */
      html, body, video {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <video autoplay controls></video>
    <h1>Custom Receiver is running!</h1>
  </body>
</html>
