<html>
<head>
  <script type="text/javascript"
      src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js">
  </script>
</head>
<body>
  <cast-media-player></cast-media-player>

  <script>
    // Initialize the CastReceiverContext
    const context = cast.framework.CastReceiverContext.getInstance();

    // Initialize PlayerManager to control media playback
    const playerManager = context.getPlayerManager();

    // Start the receiver with default options
    context.start();

    // Add a custom message listener for receiving metadata updates
      castSession.addMessageListener("urn:x-cast:com.example.custom", (namespace, event) => {
      const data = JSON.parse(event.data);

      // Log the received message for debugging
      console.log('Received message: ', data);

      // Get current media information
      const mediaInformation = playerManager.getMediaInformation();

      // Update metadata if we have the current media information
      if (mediaInformation && mediaInformation.metadata) {
        // Update the metadata fields like title, artist, and image
        mediaInformation.metadata.title = data.title || mediaInformation.metadata.title;
        mediaInformation.metadata.artist = data.artist || mediaInformation.metadata.artist;
        mediaInformation.metadata.images = [{ url: data.imageUrl }] || mediaInformation.metadata.images;

        // Apply the updated metadata without interrupting the media
        playerManager.setMediaInformation(mediaInformation);
        console.log('Metadata updated: ', mediaInformation.metadata);
      } else {
        console.error('No media information found to update.');
      }
    });

    // Optionally: Add logging for cast events (useful for debugging)
    context.addEventListener(cast.framework.system.EventType.READY, () => {
      console.log("Receiver is ready!");
    });
  </script>
</body>
</html>
