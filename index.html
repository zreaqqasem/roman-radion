<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Custom Receiver</title>
    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <script type="text/javascript">
      window.onload = function() {
        const context = cast.framework.CastReceiverContext.getInstance();
        const playerManager = context.getPlayerManager();

        // Start CAF with default options to handle media playback
        const options = new cast.framework.CastReceiverOptions();
        context.start(options);

        // Listen for custom messages
        context.addCustomMessageListener('urn:x-cast:com.example.custom', (event) => {
          const data = JSON.parse(event.data);
          
          // Update metadata
          const metadata = new cast.framework.messages.MediaMetadata(cast.framework.messages.MetadataType.MUSIC_TRACK);
          console.log("qasem.....")
          metadata.title = data.title;
          metadata.artist = data.artist;
          metadata.images = [
              { url: data.imageUrl }
          ];

          // Get current media information and update the metadata
          const mediaInformation = playerManager.getMediaInformation();
          if (mediaInformation) {
            mediaInformation.metadata = metadata;

            // Update the media info with the new metadata
            playerManager.setMediaInformation(mediaInformation);
            console.log("Metadata updated:", data);
          }
        });

        console.log("Receiver started with default player");
      };
    </script>
  </head>
  <body>
    <h1>Custom Receiver is running!</h1>
  </body>
</html>
